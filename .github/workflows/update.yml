name: Daily Update from sample_apps

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout self
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Checkout sample_apps
        uses: actions/checkout@v4
        with:
          repository: yasslab/sample_apps
          path: sample_apps

      - name: Get commit id of sample_apps
        run: |
          echo "COMMIT_ID=$(cd sample_apps && git rev-parse HEAD)" >> $GITHUB_ENV

      - name: Replace project files
        run: |
          find . -mindepth 1 -maxdepth 1 ! -name '.github' ! -name '.git' ! -name 'sample_apps' -exec rm -rf {} +
          cp -r sample_apps/7_0/ch14/. .
          rm -rf sample_apps

      - name: Rebuild README.md
        run: |
          echo "" >> README.md
          echo "# Êú¨„É™„Éù„Ç∏„Éà„É™„Å´„Å§„ÅÑ„Å¶" >> README.md
          echo "" >> README.md
          echo "„Åì„ÅÆ„É™„Éù„Ç∏„Éà„É™„ÅØ„ÄÅYassLab Êèê‰æõ„ÅÆ„É™„Éù„Ç∏„Éà„É™ [sample_apps](https://github.com/yasslab/sample_apps) ÂÜÖ„ÅÆ  " >> README.md
          echo "7_0/ch14 „Éá„Ç£„É¨„ÇØ„Éà„É™„ÇíÊïôËÇ≤ÁõÆÁöÑ„ÅßÂèñ„ÇäÂá∫„Åó„ÄÅÁí∞Â¢ÉÊßãÁØâ„ÅÆÊâãÈñì„ÇíÁúÅ„ÅÑ„Å¶„Åô„Åê„Å´Ë©¶„Åõ„Çã„Çà„ÅÜÂÜçÊßãÊàê„Åó„Åü„ÇÇ„ÅÆ„Åß„Åô„ÄÇ  " >> README.md
          echo "" >> README.md
          echo "Â≠¶Áîü„Åå [GitHub Codespaces](https://github.com/features/codespaces) „Åß**ÊúÄÂ∞è„ÅÆÊìç‰Ωú„Åß„Åô„ÅêÂãï‰ΩúÁ¢∫Ë™ç„Åå„Åß„Åç„Çã„Çà„ÅÜ„Å´**„ÄÅ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆ„É´„Éº„Éà„Å´ÈÖçÁΩÆ„Åó„Å¶„ÅÇ„Çä„Åæ„Åô„ÄÇ  " >> README.md
          echo "" >> README.md
          echo "‚Äª Êú¨„Ç≥„Éº„Éâ„ÅØ‰ª•‰∏ã„ÅÆ„Ç≥„Éü„ÉÉ„ÉàÊôÇÁÇπ„ÅÆÂÜÖÂÆπ„Çí„É´„Éº„Éà„Å´ÂÜçÊßãÊàê„Åó„Å¶„ÅÑ„Åæ„ÅôÔºö  " >> README.md
          echo "https://github.com/yasslab/sample_apps/tree/${{ env.COMMIT_ID }}  " >> README.md
          echo "" >> README.md
          echo "‚ö†Ô∏è „Åì„ÅÆ„É™„Éù„Ç∏„Éà„É™„ÅØ„ÉÜ„É≥„Éó„É¨„Éº„Éà„Å®„Åó„Å¶‰Ωø„Çè„Çå„Çã„Åì„Å®„ÇíÊÉ≥ÂÆö„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„É™„Éù„Ç∏„Éà„É™‰ΩúÊàêÂæå„ÅØ .github/workflows „ÇíÂâäÈô§„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÊ∫ñÂÇô„Éï„Çß„Éº„Ç∫„Åß„Åô„ÅÆ„Åß„ÄÅmain„Éñ„É©„É≥„ÉÅ„ÅßÁõ¥Êé•‰ΩúÊ•≠„Åô„Çã‰æã„ÇíÁ§∫„Åó„Åæ„Åô„ÄÇ  " >> README.md
          echo "" >> README.md
          echo '1. rm -rf .github' >> README.md
          echo '1. git add .' >> README.md
          echo '1. git commit -m "Finalize ch14"' >> README.md
          echo '1. git push -u origin main' >> README.md
          echo "" >> README.md

      - name: Commit and push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "üõ†Ô∏è Daily update from sample_apps ($COMMIT_ID)" || echo "No changes"
          git push -f origin main
